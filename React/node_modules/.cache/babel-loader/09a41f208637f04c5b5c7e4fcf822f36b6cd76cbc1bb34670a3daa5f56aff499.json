{"ast":null,"code":"var _jsxFileName = \"/Users/chenhan/Desktop/eti_assignment2/React/src/components/Chatroom.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Container, Row, Col, Form, Button, ListGroup } from 'react-bootstrap';\nimport AuthService from \"../services/auth.service\";\nimport ChattingServices from '../services/chatting.service';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ChatRoom(_ref) {\n  _s();\n  let {\n    chatDetail\n  } = _ref;\n  const currentUser = AuthService.getCurrentUser();\n  const [message, setMessage] = useState('');\n  const [messages, setMessages] = useState(chatDetail.messages);\n  const listGroupRef = useRef(null);\n  useEffect(() => {\n    listGroupRef.current.scrollTop = listGroupRef.current.scrollHeight;\n  }, [messages]);\n  const handleSubmit = event => {\n    event.preventDefault();\n    if (message !== \"\") {\n      ChattingServices.updateChatList(chatDetail.chat_id, {\n        \"sender_id\": currentUser.user_id,\n        \"content\": message,\n        \"timestamp\": Date.now()\n      });\n      var opp_user = \"\";\n      if (currentUser.user_type === \"Tutor\") {\n        opp_user = chatDetail.student_id;\n      } else {\n        opp_user = chatDetail.tutor_id;\n      }\n      ChattingServices.sendMsg(currentUser.user_id, opp_user, currentUser.user_type, message).then(response => {\n        console.log(response);\n        if (response.status === 200) {\n          if (messages === null) {\n            setMessages([{\n              \"sender_id\": currentUser.user_id,\n              \"content\": message,\n              \"timestamp\": Date.now()\n            }]);\n          } else {\n            setMessages([...messages, {\n              \"sender_id\": currentUser.user_id,\n              \"content\": message,\n              \"timestamp\": Date.now()\n            }]);\n          }\n          setMessage('');\n        } else {\n          console.log(\"response status: \" + response.status);\n          alert(\"Server problem\");\n        }\n      }, error => {\n        if (error.response.status == 404) {\n          alert(\"something went wrong\");\n        }\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"auth-inner\",\n    children: [currentUser.user_type === \"Student\" && /*#__PURE__*/_jsxDEV(\"strong\", {\n      children: [\"Chat with: \", chatDetail.tutor_name]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), currentUser.user_type === \"Tutor\" && /*#__PURE__*/_jsxDEV(\"strong\", {\n      children: [\"Chat with: \", chatDetail.student_name]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        className: \"\",\n        children: /*#__PURE__*/_jsxDEV(Col, {\n          className: \"mx-auto\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(ListGroup, {\n              ref: listGroupRef,\n              className: \"mb-3\",\n              style: {\n                height: '50vh',\n                maxHeight: '50vh',\n                overflowY: 'auto'\n              },\n              children: messages && messages.map((msg, index) => /*#__PURE__*/_jsxDEV(ListGroup.Item, {\n                style: {\n                  wordWrap: 'break-word',\n                  backgroundColor: msg.sender_id === currentUser.user_id ? '#F2F2F2' : '#ADD8E6',\n                  textAlign: msg.sender_id === currentUser.user_id ? 'right' : 'left'\n                },\n                children: msg.content\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 79,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 76,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(Form, {\n              onSubmit: handleSubmit,\n              children: /*#__PURE__*/_jsxDEV(Form.Group, {\n                className: \"d-flex align-items-center\",\n                children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n                  type: \"text\",\n                  placeholder: \"Enter your message\",\n                  value: message,\n                  onChange: event => setMessage(event.target.value),\n                  style: {\n                    backgroundColor: '#F2F2F2',\n                    flexGrow: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 95,\n                  columnNumber: 17\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  type: \"submit\",\n                  style: {\n                    backgroundColor: '#7DCEA0',\n                    border: 'none'\n                  },\n                  children: \"Send\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 102,\n                  columnNumber: 17\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 94,\n                columnNumber: 15\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 93,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 75,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatRoom, \"HOPtpZm7iRCqwf/YUelXm7k8tdE=\");\n_c = ChatRoom;\nexport default ChatRoom;\nvar _c;\n$RefreshReg$(_c, \"ChatRoom\");","map":{"version":3,"names":["React","useState","useRef","useEffect","Container","Row","Col","Form","Button","ListGroup","AuthService","ChattingServices","ChatRoom","chatDetail","currentUser","getCurrentUser","message","setMessage","messages","setMessages","listGroupRef","current","scrollTop","scrollHeight","handleSubmit","event","preventDefault","updateChatList","chat_id","user_id","Date","now","opp_user","user_type","student_id","tutor_id","sendMsg","then","response","console","log","status","alert","error","tutor_name","student_name","height","maxHeight","overflowY","map","msg","index","wordWrap","backgroundColor","sender_id","textAlign","content","target","value","flexGrow","border"],"sources":["/Users/chenhan/Desktop/eti_assignment2/React/src/components/Chatroom.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { Container, Row, Col, Form, Button, ListGroup } from 'react-bootstrap';\nimport AuthService from \"../services/auth.service\";\nimport ChattingServices from '../services/chatting.service';\n\nfunction ChatRoom({ chatDetail }) {\n\n  const currentUser = AuthService.getCurrentUser();\n\n  const [message, setMessage] = useState('');\n  \n  const [messages, setMessages] = useState(chatDetail.messages);\n  const listGroupRef = useRef(null);\n\n  useEffect(() => {\n    listGroupRef.current.scrollTop = listGroupRef.current.scrollHeight;\n  }, [messages]);\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    if (message !== \"\") {\n          ChattingServices.updateChatList(chatDetail.chat_id, {\n            \"sender_id\": currentUser.user_id,\n            \"content\": message,\n            \"timestamp\": Date.now()\n        })\n        var opp_user = \"\"\n        if (currentUser.user_type === \"Tutor\") {\n            opp_user = chatDetail.student_id\n        } else {\n            opp_user = chatDetail.tutor_id\n        }\n        ChattingServices.sendMsg(currentUser.user_id, opp_user, currentUser.user_type, message).then(\n            (response) => {\n              console.log(response)\n              if (response.status === 200) {\n                if (messages === null) {\n                  setMessages([{\n                      \"sender_id\": currentUser.user_id,\n                      \"content\": message,\n                      \"timestamp\": Date.now()\n                    }])\n                } else {\n                  setMessages([...messages, {\n                    \"sender_id\": currentUser.user_id,\n                    \"content\": message,\n                    \"timestamp\": Date.now()\n                }]);\n                }\n                setMessage('');\n              } else {\n                console.log(\"response status: \" + response.status);\n                alert(\"Server problem\")\n              }\n            },\n            (error) => {\n              if (error.response.status == 404){\n                alert(\"something went wrong\")\n              }\n            }\n        );\n    }\n  };\n  return (\n    <div className='auth-inner'>\n    {currentUser.user_type === \"Student\" && (\n      <strong>Chat with: {chatDetail.tutor_name}</strong>\n    )}\n    {currentUser.user_type === \"Tutor\" && (\n          <strong>Chat with: {chatDetail.student_name}</strong>\n    )}\n    <Container>\n      <Row className=\"\">\n        <Col  className=\"mx-auto\">\n          <div>\n            <ListGroup ref={listGroupRef} className=\"mb-3\" style={{height: '50vh', maxHeight: '50vh', overflowY: 'auto' }}>\n             { messages && (\n                messages.map((msg, index) => (\n                  <ListGroup.Item \n                    key={index} \n                    style={{ \n                      wordWrap: 'break-word',\n                      backgroundColor: msg.sender_id === currentUser.user_id ? '#F2F2F2' : '#ADD8E6',\n                      textAlign:  msg.sender_id === currentUser.user_id ? 'right' : 'left'\n                    }}\n                  >\n                    {msg.content}\n                  </ListGroup.Item>\n                ))\n              )}\n\n            </ListGroup>\n            <Form onSubmit={handleSubmit}>\n              <Form.Group className=\"d-flex align-items-center\">\n                <Form.Control\n                  type=\"text\"\n                  placeholder=\"Enter your message\"\n                  value={message}\n                  onChange={(event) => setMessage(event.target.value)}\n                  style={{ backgroundColor: '#F2F2F2', flexGrow: 1 }}\n                />\n                <Button type=\"submit\" style={{ backgroundColor: '#7DCEA0', border: 'none' }}>\n                  Send\n                </Button>\n              </Form.Group>\n            </Form>\n          </div>\n        </Col>\n      </Row>\n    </Container>\n\n    </div>\n  );\n}\n\nexport default ChatRoom;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}